<h1>Récapitulatif de commande</h1>

<p><strong>Œuvre :</strong> <%= @order.order_items.first.artwork.title %></p>
<p><strong>Montant :</strong> <%= number_to_currency(@order.total_amount) %></p>

<!-- Stripe Checkout avec JS -->

<div id="payment-element"></div>
<button id="submit">Payer</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
  fetch("/payment_intent/<%= @order.id %>")
    .then(res => res.json())
    .then(data => {
      const stripe = Stripe("<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>")
      stripe.confirmCardPayment(data.client_secret, {
        payment_method: {
          card: elements.create("card")
        }
      }).then(function(result) {
        if (result.paymentIntent.status === 'succeeded') {
          window.location.href = "/"
        }
      });
    });
</script>


<!-- <h1>Récapitulatif</h1>
<p><strong>Montant :</strong> <%= number_to_currency(@order.total_amount) %></p>

<div id="payment-element"></div>
<button id="submit">Payer</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const response = await fetch("/payment_intent/<%= @order.id %>");
    const data = await response.json();

    const stripe = Stripe("<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>");
    const elements = stripe.elements();
    const cardElement = elements.create("card");
    cardElement.mount("#payment-element");

    document.getElementById("submit").addEventListener("click", async () => {
      const result = await stripe.confirmCardPayment(data.client_secret, {
        payment_method: {
          card: cardElement
        }
      });

      if (result.error) {
        alert(result.error.message);
      } else if (result.paymentIntent.status === "succeeded") {
        alert("Paiement réussi !");
        window.location.href = "/";
      }
    });
  });
</script> -->
